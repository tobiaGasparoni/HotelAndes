CREATE SEQUENCE HOTELANDES_SEQUENCE;

CREATE TABLE CONVENCIONES (
    ID NUMBER NOT NULL PRIMARY KEY,
    NOMBRE VARCHAR2(255) NOT NULL,
    FECHA_INICIO TIMESTAMP NOT NULL,
    FECHA_FINAL TIMESTAMP NOT NULL
);

CREATE TABLE PLANES (
    ID NUMBER NOT NULL PRIMARY KEY,
    NOMBRE VARCHAR2(255) NOT NULL,
    TIPO VARCHAR2(255) NOT NULL,
    COSTO NUMBER NOT NULL,
    DESCUENTO_ESTADIA NUMBER NOT NULL,
    DESCUENTO_PRODUCTOS NUMBER NOT NULL,
    DIAS_ESTADIA NUMBER NOT NULL,
    DESCRIPCION VARCHAR2(500)
);

CREATE TABLE INTERNET (
    ID NUMBER NOT NULL PRIMARY KEY,
    CAPACIDAD NUMBER NOT NULL,
    COSTO NUMBER NOT NULL
);

CREATE TABLE HOTELES (
    ID NUMBER NOT NULL PRIMARY KEY,
    NOMBRE VARCHAR2(255 BYTE) NOT NULL,
    CIUDAD VARCHAR2(255 BYTE) NOT NULL,
    PAIS VARCHAR2(255 BYTE) NOT NULL,
    DIRECCION VARCHAR2(255 BYTE) NOT NULL,
    INTERNET_ID NUMBER REFERENCES INTERNET(ID) UNIQUE
);

CREATE TABLE SERVICIOS_PRODUCTOS (
    ID NUMBER NOT NULL PRIMARY KEY,
    NOMBRE VARCHAR2(255) NOT NULL,
    TIPO VARCHAR(20) NOT NULL CHECK(TIPO IN ('RESTAURANTE','BAR','PRESTAMO','TIENDA','SUPERMERCADO')),
    EN_MANTENIMIENTO NUMBER NOT NULL CHECK(EN_MANTENIMIENTO IN(0,1)),
    CAPACIDAD NUMBER NOT NULL,
    OCUPACION_ACTUAL NUMBER NOT NULL,
    ESTILO VARCHAR2(255) NOT NULL,
    HOTEL_ID NUMBER NOT NULL REFERENCES HOTELES(ID)
);

CREATE TABLE SERVICIOS_SALON (
    ID NUMBER NOT NULL PRIMARY KEY,
    DESCRIPCION VARCHAR2(500) NOT NULL,
    EN_MANTENIMIENTO NUMBER NOT NULL CHECK(EN_MANTENIMIENTO IN(0,1)),
    COSTO NUMBER NOT NULL,
    CAPACIDAD NUMBER NOT NULL,
    HOTEL_ID NUMBER REFERENCES HOTELES(ID)
);

CREATE TABLE SERVICIOS_COMODIDAD (
    ID NUMBER PRIMARY KEY,
    NOMBRE VARCHAR2(255) NOT NULL,
    DESCRIPCION VARCHAR2(500) NOT NULL,
    COSTO NUMBER NOT NULL,
    EN_MANTENIMIENTO NUMBER NOT NULL CHECK(EN_MANTENIMIENTO IN(0,1)),
    DURACION NUMBER NOT NULL,
    HORARIO VARCHAR2(255),
    HOTEL_ID NUMBER REFERENCES HOTELES(ID)
);

CREATE TABLE SERVICIOS_HOTEL (
    ID NUMBER NOT NULL PRIMARY KEY,
    NOMBRE VARCHAR2(255) NOT NULL,
    CAPACIDAD NUMBER NOT NULL,
    OCUPACION_ACTUAL NUMBER NOT NULL,
    DESCRIPCION VARCHAR2(500) NOT NULL,
    EN_MANTENIMIENTO NUMBER NOT NULL CHECK(EN_MANTENIMIENTO IN(0,1)),
    HORARIO VARCHAR2(255), --CAMBIO AQUIIIII
    HOTEL_ID NUMBER NOT NULL REFERENCES HOTELES(ID)
);

CREATE TABLE TIPOS_HABITACION (
    ID NUMBER NOT NULL PRIMARY KEY,
    NOMBRE VARCHAR2(255) NOT NULL UNIQUE,
    DESCRIPCION VARCHAR2(500) NOT NULL
);

CREATE TABLE HABITACIONES (
    ID NUMBER NOT NULL PRIMARY KEY,
    CAPACIDAD NUMBER NOT NULL,
    CONSUMO NUMBER NOT NULL,
    DISPONIBLE NUMBER NOT NULL CHECK(DISPONIBLE IN(0,1)), --Esta en una reserva en este momento.
    LLEGADA_CLIENTE NUMBER CHECK(LLEGADA_CLIENTE IN(0,1)),
    TIPO NUMBER NOT NULL REFERENCES TIPOS_HABITACION(ID),
    HOTEL_ID NUMBER NOT NULL REFERENCES HOTELES(ID),
    EN_MANTENIMIENTO NUMBER CHECK(EN_MANTENIMIENTO IN(0,1))
);

CREATE TABLE USUARIOS (
    TIPO_DOCUMENTO VARCHAR2(255) NOT NULL,
    DOCUMENTO VARCHAR(255) NOT NULL,
    TIPO VARCHAR2(20) NOT NULL,
    CONSTRAINT ID PRIMARY KEY (TIPO_DOCUMENTO,DOCUMENTO,TIPO),
    NOMBRE VARCHAR2(255) NOT NULL,
    CORREO VARCHAR2(255) NOT NULL,
    LOGIN VARCHAR2(255) NOT NULL UNIQUE,
    CLAVE VARCHAR2(255) NOT NULL,
    CONSTRAINT check_tipo CHECK( TIPO IN('CLIENTE','RECEPCIONISTA','EMPLEADO','ADMINISTRADOR', 'GERENTE'))
);

CREATE TABLE RESERVAS(
    ID NUMBER NOT NULL PRIMARY KEY,
    FECHA_ENTRADA TIMESTAMP NOT NULL,
    FECHA_SALIDA TIMESTAMP NOT NULL,
    NUMERO_PERSONAS NUMBER NOT NULL,
    PLAN_PAGO NUMBER REFERENCES PLANES(ID), --QUITAR DEL UML
    TIPO_DOCUMENTO VARCHAR2(255) NOT NULL,
    DOCUMENTO VARCHAR(255) NOT NULL,
    TIPO VARCHAR2(20) NOT NULL CHECK(TIPO IN('CLIENTE')),
    FOREIGN KEY(TIPO_DOCUMENTO,DOCUMENTO,TIPO) REFERENCES USUARIOS,
    HABITACION_ID NUMBER NOT NULL REFERENCES HABITACIONES(ID),
    CONVENCION_ID NUMBER REFERENCES CONVENCIONES(ID)
);

CREATE TABLE RESERVAS_SERVICIO (
    ID NUMBER NOT NULL PRIMARY KEY,
    COSTO NUMBER NOT NULL,
    DESCRIPCION VARCHAR2(255) NOT NULL,
    FECHA TIMESTAMP NOT NULL,
    NOMBRE_EMPLEADO VARCHAR2(255) NOT NULL,
    NUM_CLIENTES NUMBER NOT NULL,
    TIPO_SERVICIO VARCHAR(20) NOT NULL CHECK(TIPO_SERVICIO IN('HOTEL','COMODIDAD','SALON','PRODUCTOS')),
    SERVICIO_ID NUMBER NOT NULL,
    TIPO_DOCUMENTO VARCHAR2(255) NOT NULL,
    DOCUMENTO VARCHAR(255) NOT NULL,
    TIPO VARCHAR2(20) NOT NULL CHECK(TIPO IN('CLIENTE')),
    FOREIGN KEY(TIPO_DOCUMENTO,DOCUMENTO,TIPO) REFERENCES USUARIOS,
    HOTEL_ID NUMBER NOT NULL REFERENCES HOTELES(ID),
    CONVENCION_ID NUMBER REFERENCES CONVENCIONES(ID)
);

CREATE TABLE CUENTAS (
    ID NUMBER NOT NULL PRIMARY KEY,
    COSTO NUMBER NOT NULL, --AGREGAR A UML
    PAGADA NUMBER NOT NULL CHECK (PAGADA IN (1,0)),
    RESERVA_ID NUMBER NOT NULL REFERENCES RESERVAS(ID),
    HOTEL_ID NUMBER NOT NULL REFERENCES HOTELES(ID)
);

CREATE TABLE DOTACIONES (
    ID NUMBER NOT NULL PRIMARY KEY,
    NOMBRE VARCHAR2(255) NOT NULL,
    COSTO NUMBER NOT NULL
);

CREATE TABLE CONSUMOS ( 
--Agregar id_habitacion en relacional (varias habitaciones no pueden tener un mismo consumo (se pagaria varias veces el mismo precio))
    ID NUMBER NOT NULL PRIMARY KEY,
    FECHA TIMESTAMP NOT NULL,
    COSTO NUMBER NOT NULL,
    DESCRIPCION VARCHAR2(255) NOT NULL,
    ID_SERVICIO_COMODIDAD NUMBER REFERENCES SERVICIOS_COMODIDAD(ID),
    ID_SERVICIO_HOTEL NUMBER REFERENCES SERVICIOS_HOTEL(ID),
    ID_SERVICIO_PRODUCTOS NUMBER REFERENCES SERVICIOS_PRODUCTOS(ID),
    ID_SERVICIO_SALON NUMBER REFERENCES SERVICIOS_SALON(ID),
    ID_HABITACION NUMBER REFERENCES HABITACIONES(ID) NOT NULL
);

CREATE TABLE PRODUCTOS (
    ID NUMBER NOT NULL PRIMARY KEY,
    NOMBRE VARCHAR2(255) NOT NULL,
    COSTO NUMBER NOT NULL
);

CREATE TABLE MAQUINAS (
    ID NUMBER NOT NULL PRIMARY KEY,
    TIPO_MAQUINA VARCHAR2(255) NOT NULL,
    SERVICIO_HOTEL_ID NUMBER NOT NULL REFERENCES SERVICIOS_HOTEL(ID)
);

--JOINS

CREATE TABLE JOIN_PLAN_TO_HOTEL (
    HOTEL_ID NUMBER NOT NULL REFERENCES HOTELES(ID),
    PLAN_ID NUMBER NOT NULL REFERENCES PLANES(ID)
);

CREATE TABLE JOIN_PRODUCTO_TO_SERVICIO (
    SERVICIO_ID NUMBER NOT NULL REFERENCES SERVICIOS_PRODUCTOS(ID),
    PRODUCTO_ID NUMBER NOT NULL REFERENCES PRODUCTOS(ID)
);

CREATE TABLE JOIN_HABITACION_TO_DOTACION (
    DOTACION_ID NUMBER NOT NULL REFERENCES DOTACIONES(ID),
    HABITACION_ID NUMBER NOT NULL REFERENCES HABITACIONES(ID)
);

COMMIT;